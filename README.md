## Preprocessing Notebook Readme

The notebook, `preprocessing.ipynb`, is designed for the initial data loading, exploration, and basic preprocessing steps for a housing price prediction task. It covers the following key areas:

### 1. Data Loading
- Loads the `train(1).xlsx` and `test2.xlsx` datasets into pandas DataFrames.

### 2. Initial Data Inspection
- Displays the shapes (number of rows and columns) of both the training and testing datasets.
- Prints the column names of both DataFrames to understand the available features.
- Shows the first few rows of the training dataset using `df.head()` to get a glimpse of the data structure and values.

### 3. Missing Value Analysis
- Checks for and reports any missing values in both the training and testing datasets, ensuring data completeness before further analysis.

### 4. Basic Data Visualization
- **Price Distribution:** Visualizes the distribution of house prices in the training set using a histogram to understand its spread and skewness.
- **Price vs. Living Area:** Creates a scatter plot to observe the relationship between `sqft_living` and `price`, identifying potential correlations.
- **Log-Transformed Price Distribution:** Shows the distribution of log-transformed prices, which is often done to normalize skewed target variables.
- **Geospatial Distribution of Prices:** Plots house prices on a geographical map using latitude and longitude, colored by log-transformed price, to visualize spatial patterns.

### Libraries Used:
- `pandas` for data manipulation and analysis.
- `numpy` for numerical operations.
- `matplotlib.pyplot` for basic plotting.
- `seaborn` for enhanced statistical data visualization.
# Data Fetcher for Satellite Images

This script downloads satellite images from Mapbox based on geographical coordinates (`lat` and `long`) provided in an Excel file. Each image is saved as a PNG file, named after its corresponding row index in the input Excel file.

## Features
- Fetches satellite images from Mapbox API.
- Supports retries for failed downloads.
- Resume-safe: Skips downloading images that already exist.
- Records indices of failed downloads for transparency.

## Setup
1. **Install Dependencies**:
   ```bash
   pip install openpyxl requests pandas
   ```

2. **Mapbox Access Token**:
   Obtain a Mapbox Public Access Token from your Mapbox account. Replace the placeholder `MAPBOX_TOKEN` in the script with your actual token.

## Usage
1. **Input Data**:
   Ensure you have an Excel file (e.g., `train(1).xlsx`) containing at least `lat` (latitude) and `long` (longitude) columns. These columns are used to specify the location for image downloads.

2. **Run the Script**:
   Execute the Python script. It will read the Excel file, iterate through each row, and attempt to download a satellite image for the given coordinates.

   ```python
   # Configuration (as seen in the notebook)
   EXCEL_FILE = "train(1).xlsx"
   OUTPUT_DIR = "mapbox_images"
   IMAGE_SIZE = "512x512"
   ZOOM = 18
   MAPBOX_TOKEN = "YOUR_MAPBOX_PUBLIC_ACCESS_TOKEN" # <--- REPLACE THIS
   DELAY = 0.15
   MAX_RETRIES = 3
   TIMEOUT = 10

   # ... (rest of the script for downloading images)
   ```

## Output
- **`mapbox_images/`**: A directory created in the same location as the script, containing all successfully downloaded satellite images (e.g., `img_0.png`, `img_1.png`, etc.).
- **`failed_image_indices.csv`** (optional): If any image downloads fail after retries, a CSV file will be generated listing the indices of the rows for which images could not be downloaded.

## Configuration Parameters
- `EXCEL_FILE`: Path to your input Excel file.
- `OUTPUT_DIR`: Directory where downloaded images will be saved.
- `IMAGE_SIZE`: Resolution of the downloaded images (e.g., `512x512`).
- `ZOOM`: Zoom level for the Mapbox static images (higher values mean more detail).
- `MAPBOX_TOKEN`: Your personal Mapbox Public Access Token.
- `DELAY`: Time delay (in seconds) between image download requests to avoid hitting API rate limits.
- `MAX_RETRIES`: Maximum number of attempts to download an image if the initial request fails.
- `TIMEOUT`: Timeout (in seconds) for each HTTP request.

## Example
After running the script, you can zip the `mapbox_images` directory and download it:
```bash
!zip -r mapbox_images.zip mapbox_images
from google.colab import files
files.download("mapbox_images.zip")
```
# Model-training-notebook: Satellite + Tabular Property Price Prediction ðŸ›°ï¸

**Kaggle Notebook**

This notebook (`kaggle-notebook2.ipynb`) builds and compares three approaches for property price prediction:

- **XGBoost** (tabular-only baseline; trained on log(price) for stability)
- **Hybrid model** (tabular features + satellite images using a frozen ResNet18 backbone)
- **Ensemble** (weighted average of XGBoost + Hybrid)

It also includes EDA, image diagnostics, Grad-CAM explainability, and scripts to generate `predictions.csv` and visualizations.

## Key artifacts generated by the notebook

- `predictions.csv` â€” ensemble test predictions
- `model_comparison.png` â€” RMSE / RÂ² / MAPE comparison
- `gradcam_visualization.png` â€” Grad-CAM heatmaps
- `sample_images.png`, `prediction_samples.png` â€” diagnostic visuals

## Requirements

Install the core packages (conda or pip):

```
pip install numpy pandas matplotlib seaborn pillow tqdm openpyxl xgboost scikit-learn torch torchvision opencv-python
```

Notes:
- GPU recommended for training (PyTorch + ResNet). The notebook auto-detects device (`cuda` if available).
- `openpyxl` is used for reading `.xlsx` files.

## Dataset & paths

Default local configuration (edit the first cell if needed):

- `data/train.xlsx` â€” training table
- `data/test.xlsx` â€” test table
- `mapbox_images/` â€” directory with satellite images named `img_0.png` ... `img_N.png`

On Kaggle set `IS_KAGGLE = True` (the notebook checks `/kaggle`) and paths will be set to the dataset folder.

**IMPORTANT:** Images are indexed by ROW INDEX (0-based). Use row indices (not the `id` column) to find images: `img_{row_index}.png`.

## How to run

1. Place `train.xlsx`, `test.xlsx`, and the `mapbox_images/` folder in the locations configured in the first notebook cell.
2. Open `kaggle-notebook2.ipynb` and run cells from top to bottom.
3. Outputs are saved to `OUTPUT_DIR` (default `outputs/` locally, `/kaggle/working` on Kaggle).

Tip: For quick iteration reduce `CONFIG['epochs']` and `CONFIG['batch_size']` in the config cell.

## Implementation notes & gotchas

- `CONFIG['use_log_target'] = True` is used for the XGBoost training (log1p). The hybrid model uses original prices for stability.
- The hybrid model uses a frozen ResNet18 backbone and concatenates processed image features with a tabular MLP.
- `PropertyDataset` aligns images using the original DataFrame row indices â€” ensure image availability matches row count.
- Grad-CAM temporarily enables gradients on the frozen CNN only for visualization.

## Reproducibility

- Random seed: `42` (set in config). Results may vary slightly across hardware and library versions.

---
