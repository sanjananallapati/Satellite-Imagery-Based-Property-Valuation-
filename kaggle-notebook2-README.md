# Kaggle Notebook: Satellite + Tabular Property Price Prediction üõ∞Ô∏è

**Short description**

This notebook (`kaggle-notebook2.ipynb`) builds and compares three approaches for property price prediction:

- **XGBoost** (tabular-only baseline; trained on log(price) for stability)
- **Hybrid model** (tabular features + satellite images using a frozen ResNet18 backbone)
- **Ensemble** (weighted average of XGBoost + Hybrid)

It also includes EDA, image diagnostics, Grad-CAM explainability, and scripts to generate `predictions.csv` and visualizations.

## Key artifacts generated by the notebook

- `predictions.csv` ‚Äî ensemble test predictions
- `model_comparison.png` ‚Äî RMSE / R¬≤ / MAPE comparison
- `gradcam_visualization.png` ‚Äî Grad-CAM heatmaps
- `sample_images.png`, `prediction_samples.png` ‚Äî diagnostic visuals

## Requirements

Install the core packages (conda or pip):

```
pip install numpy pandas matplotlib seaborn pillow tqdm openpyxl xgboost scikit-learn torch torchvision opencv-python
```

Notes:
- GPU recommended for training (PyTorch + ResNet). The notebook auto-detects device (`cuda` if available).
- `openpyxl` is used for reading `.xlsx` files.

## Dataset & paths

Default local configuration (edit the first cell if needed):

- `data/train.xlsx` ‚Äî training table
- `data/test.xlsx` ‚Äî test table
- `mapbox_images/` ‚Äî directory with satellite images named `img_0.png` ... `img_N.png`

On Kaggle set `IS_KAGGLE = True` (the notebook checks `/kaggle`) and paths will be set to the dataset folder.

**IMPORTANT:** Images are indexed by ROW INDEX (0-based). Use row indices (not the `id` column) to find images: `img_{row_index}.png`.

## How to run

1. Place `train.xlsx`, `test.xlsx`, and the `mapbox_images/` folder in the locations configured in the first notebook cell.
2. Open `kaggle-notebook2.ipynb` and run cells from top to bottom.
3. Outputs are saved to `OUTPUT_DIR` (default `outputs/` locally, `/kaggle/working` on Kaggle).

Tip: For quick iteration reduce `CONFIG['epochs']` and `CONFIG['batch_size']` in the config cell.

## Implementation notes & gotchas

- `CONFIG['use_log_target'] = True` is used for the XGBoost training (log1p). The hybrid model uses original prices for stability.
- The hybrid model uses a frozen ResNet18 backbone and concatenates processed image features with a tabular MLP.
- `PropertyDataset` aligns images using the original DataFrame row indices ‚Äî ensure image availability matches row count.
- Grad-CAM temporarily enables gradients on the frozen CNN only for visualization.

## Reproducibility

- Random seed: `42` (set in config). Results may vary slightly across hardware and library versions.

---

If you'd like, I can:
- Overwrite the existing `README.md` directly,
- Add a `requirements.txt` or `environment.yml`, or
- Add a small `run.sh` / `Makefile` to run the notebook non-interactively.

Tell me which option you prefer.